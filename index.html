<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ® Jogo da Forca Online</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  display: flex; flex-direction: column; align-items: center;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh; color: white; padding: 20px;
}
h1 { margin-bottom: 20px; text-align: center; }
.game-card { background: white; color: #2d3748; border-radius: 20px; padding: 30px; max-width: 700px; width: 100%; margin-bottom: 20px; }
.hidden { display: none !important; }
#keyboard button { margin: 5px; width: 45px; height: 45px; font-weight: bold; border-radius: 8px; cursor: pointer; }
#keyboard button.used { background: #cbd5e0; color: #a0aec0; cursor: not-allowed; }
.letter-box { display: inline-flex; align-items: center; justify-content: center; width: 50px; height: 60px; border-bottom: 4px solid #667eea; font-size: 32px; font-weight: bold; margin: 2px; }
.letter-box.revealed { color: #48bb78; }
.stats { margin-top: 10px; }
.stats div { display: flex; justify-content: space-between; margin: 5px 0; }
.modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:2000; }
.modal-content { background:white; color:#2d3748; padding: 30px; border-radius: 15px; text-align:center; }
.modal-content button { margin-top: 20px; }
.audio-controls { position: fixed; top: 20px; right: 20px; z-index:1000; }
</style>
</head>
<body>

<audio id="bgMusic" loop autoplay>
  <source src="https://customer-assets.emergentagent.com/job_letra-puzzle/artifacts/oq47urn4_WhatsApp-Video-2026-02-02-at-20.16.54.mp3" type="audio/mpeg">
</audio>
<div class="audio-controls">
  <button id="muteBtn" onclick="toggleMute()">ðŸ”Š</button>
</div>

<h1>ðŸŽ® Jogo da Forca Online</h1>

<div id="playerDiv" class="game-card">
  <h2 id="playerTitle"></h2>
  <div id="player1Area">
    <input type="text" id="wordInput" placeholder="Digite a palavra secreta..." />
    <button onclick="submitWord()">ComeÃ§ar Jogo</button>
  </div>
  <div id="player2Area" class="hidden">
    <div id="wordDisplay"></div>
    <div class="stats">
      <div><span>Tentativas restantes:</span> <span id="errorsLeft">6</span></div>
      <div><span>Letras erradas:</span> <span id="wrongLetters">Nenhuma</span></div>
      <div><span>PontuaÃ§Ã£o:</span> <span id="pointsDisplay">0 - 0</span></div>
    </div>
    <div id="keyboard"></div>
    <input type="text" id="letterInput" maxlength="1" placeholder="Digite letra..." />
    <button onclick="guessLetter()">Tentar</button>
  </div>
</div>

<div id="modal" class="modal hidden">
  <div class="modal-content">
    <h2 id="modalTitle"></h2>
    <p id="modalMessage"></p>
    <button onclick="closeModal()">Jogar Novamente</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdxd54oFM3eWH1duC5BTdJzjGGRDLMq-Q",
  authDomain: "mary-cb817.firebaseapp.com",
  databaseURL: "https://mary-cb817-default-rtdb.firebaseio.com",
  projectId: "mary-cb817",
  storageBucket: "mary-cb817.firebasestorage.app",
  messagingSenderId: "887348832569",
  appId: "1:887348832569:web:c6d9c32a1a1c402b8960e8",
  measurementId: "G-86HWEH554E"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Recuperar dados do jogador e sala
const playerName = localStorage.getItem('playerName');
const playerRole = localStorage.getItem('playerRole');
const roomName = localStorage.getItem('roomName');

document.getElementById('playerTitle').textContent = `OlÃ¡ ${playerName}, vocÃª Ã© ${playerRole == '1' ? 'Jogador 1' : 'Jogador 2'}`;

// Elementos
const player1Area = document.getElementById('player1Area');
const player2Area = document.getElementById('player2Area');
const wordInput = document.getElementById('wordInput');
const wordDisplay = document.getElementById('wordDisplay');
const errorsLeftEl = document.getElementById('errorsLeft');
const wrongLettersEl = document.getElementById('wrongLetters');
const pointsDisplay = document.getElementById('pointsDisplay');
const letterInput = document.getElementById('letterInput');
const keyboardDiv = document.getElementById('keyboard');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalMessage = document.getElementById('modalMessage');
const bgMusic = document.getElementById('bgMusic');

let currentWord = '';
let displayWord = [];
let errors = 6;
let wrongLetters = [];
let points = {player1:0, player2:0};

// MÃºsica
function toggleMute() {
  bgMusic.muted = !bgMusic.muted;
  document.getElementById('muteBtn').textContent = bgMusic.muted ? 'ðŸ”‡' : 'ðŸ”Š';
}

// ===== FunÃ§Ãµes =====

function createKeyboard() {
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
  keyboardDiv.innerHTML = '';
  letters.forEach(l => {
    const btn = document.createElement('button');
    btn.textContent = l;
    btn.onclick = () => guessLetterLogic(l, btn);
    keyboardDiv.appendChild(btn);
  });
}

function submitWord() {
  const word = wordInput.value.trim().toUpperCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  if(!word) return alert('Digite a palavra!');
  set(ref(db,'rooms/'+roomName),{
    word: word,
    guesses: {},
    errors: 6,
    wrongLetters: [],
    player1: playerRole=='1'?playerName:'',
    player2: playerRole=='2'?playerName:'',
    points: points
  }, {merge:true});
  player1Area.classList.add('hidden');
}

function updateDisplay() {
  wordDisplay.innerHTML = displayWord.map(l=>`<span class="letter-box ${l!=='_'?'revealed':''}">${l}</span>`).join('');
}

function guessLetter() {
  const letter = letterInput.value.trim().toUpperCase();
  letterInput.value='';
  if(!letter) return;
  guessLetterLogic(letter);
}

function guessLetterLogic(letter, btn=null){
  if(btn) btn.disabled = true;
  if(wrongLetters.includes(letter) || displayWord.includes(letter)) return;

  get(ref(db,'rooms/'+roomName+'/word')).then(snapshot=>{
    currentWord = snapshot.val();
    if(currentWord.includes(letter)){
      displayWord = currentWord.split('').map(l=>displayWord.includes(l)?l: l===letter?l:'_');
    } else {
      wrongLetters.push(letter);
      errors--;
      update(ref(db,'rooms/'+roomName), {errors:errors, wrongLetters:wrongLetters});
    }
    updateDisplay();
    errorsLeftEl.textContent = errors;
    wrongLettersEl.textContent = wrongLetters.join(', ') || 'Nenhuma';
    checkWinLose();
  });
}

function checkWinLose(){
  if(!displayWord.includes('_') && currentWord){
    points[playerRole=='1'?'player1':'player2']++;
    showModal('VitÃ³ria!','VocÃª adivinhou a palavra!');
    update(ref(db,'rooms/'+roomName+'/points'),points);
  }
  if(errors<=0){
    points[playerRole=='1'?'player2':'player1']++;
    showModal('Derrota!','VocÃª nÃ£o adivinhou a palavra.');
    update(ref(db,'rooms/'+roomName+'/points'),points);
  }
  pointsDisplay.textContent = `${points.player1} - ${points.player2}`;
}

function showModal(title,msg){
  modalTitle.textContent = title;
  modalMessage.textContent = msg;
  modal.classList.remove('hidden');
}

function closeModal(){
  modal.classList.add('hidden');
  // reset game
  displayWord = [];
  wrongLetters = [];
  errors = 6;
  wordDisplay.innerHTML='';
  wrongLettersEl.textContent='Nenhuma';
  errorsLeftEl.textContent=errors;
  letterInput.value='';
  createKeyboard();
  if(playerRole=='1') player1Area.classList.remove('hidden');
  if(playerRole=='2') player2Area.classList.remove('hidden');
}

// AtualizaÃ§Ãµes em tempo real
const roomRef = ref(db,'rooms/'+roomName);
onValue(roomRef, snapshot=>{
  const data = snapshot.val();
  if(!data) return;
  currentWord = data.word || '';
  points = data.points || {player1:0,player2:0};
  pointsDisplay.textContent = `${points.player1} - ${points.player2}`;
  errors = data.errors ?? 6;
  errorsLeftEl.textContent = errors;
  wrongLetters = data.wrongLetters || [];
  wrongLettersEl.textContent = wrongLetters.join(', ') || 'Nenhuma';
  if(playerRole=='2'){
    displayWord = currentWord.split('').map(l=>data.guesses?.[l]?l:'_');
    updateDisplay();
    player1Area.classList.add('hidden');
    player2Area.classList.remove('hidden');
    createKeyboard();
  }
});

// Suporte enter
document.addEventListener('keypress', e=>{
  if(e.key==='Enter'){
    if(playerRole=='1') submitWord();
    if(playerRole=='2') guessLetter();
  }
});
</script>
</body>
</html>
